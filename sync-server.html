<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Sync Server - Anki Manual</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="css/kbd.css">

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item affix "><a href="intro.html">Introduction</a></li><li class="chapter-item "><a href="background.html"><strong aria-hidden="true">1.</strong> Background</a></li><li class="chapter-item "><a href="platform/intro.html"><strong aria-hidden="true">2.</strong> Platform Notes</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="platform/windows/installing.html"><strong aria-hidden="true">2.1.</strong> Windows</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="platform/windows/installing.html"><strong aria-hidden="true">2.1.1.</strong> Install & Upgrade</a></li><li class="chapter-item "><a href="platform/windows/installation-issues.html"><strong aria-hidden="true">2.1.2.</strong> Installation Issues</a></li><li class="chapter-item "><a href="platform/windows/startup-issues.html"><strong aria-hidden="true">2.1.3.</strong> Startup Issues</a></li><li class="chapter-item "><a href="platform/windows/display-issues.html"><strong aria-hidden="true">2.1.4.</strong> Display Issues</a></li><li class="chapter-item "><a href="platform/windows/copy-and-paste.html"><strong aria-hidden="true">2.1.5.</strong> Copy and Paste Issues</a></li><li class="chapter-item "><a href="platform/windows/text-size.html"><strong aria-hidden="true">2.1.6.</strong> Text Size</a></li><li class="chapter-item "><a href="platform/windows/permission-problems.html"><strong aria-hidden="true">2.1.7.</strong> Permission Problems</a></li></ol></li><li class="chapter-item "><a href="platform/mac/installing.html"><strong aria-hidden="true">2.2.</strong> macOS</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="platform/mac/installing.html"><strong aria-hidden="true">2.2.1.</strong> Install & Upgrade</a></li><li class="chapter-item "><a href="platform/mac/display-issues.html"><strong aria-hidden="true">2.2.2.</strong> Display Issues</a></li></ol></li><li class="chapter-item "><a href="platform/linux/installing.html"><strong aria-hidden="true">2.3.</strong> Linux</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="platform/linux/installing.html"><strong aria-hidden="true">2.3.1.</strong> Install & Upgrade</a></li><li class="chapter-item "><a href="platform/linux/missing-libraries.html"><strong aria-hidden="true">2.3.2.</strong> Missing Libraries</a></li><li class="chapter-item "><a href="platform/linux/display-issues.html"><strong aria-hidden="true">2.3.3.</strong> Display Issues</a></li><li class="chapter-item "><a href="platform/linux/blank-window.html"><strong aria-hidden="true">2.3.4.</strong> Blank Main Window</a></li><li class="chapter-item "><a href="platform/linux/distro-packages.html"><strong aria-hidden="true">2.3.5.</strong> Linux Distro Packages</a></li><li class="chapter-item "><a href="platform/linux/gtk-theme.html"><strong aria-hidden="true">2.3.6.</strong> Incorrect GTK Theme</a></li><li class="chapter-item "><a href="platform/linux/wayland.html"><strong aria-hidden="true">2.3.7.</strong> Wayland</a></li><li class="chapter-item "><a href="platform/linux/input-methods.html"><strong aria-hidden="true">2.3.8.</strong> Input Methods</a></li></ol></li></ol></li><li class="chapter-item "><a href="getting-started.html"><strong aria-hidden="true">3.</strong> Getting Started</a></li><li class="chapter-item "><a href="studying.html"><strong aria-hidden="true">4.</strong> Studying</a></li><li class="chapter-item "><a href="editing.html"><strong aria-hidden="true">5.</strong> Adding/Editing</a></li><li class="chapter-item "><a href="templates/intro.html"><strong aria-hidden="true">6.</strong> Card Templates</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="templates/fields.html"><strong aria-hidden="true">6.1.</strong> Field Replacements</a></li><li class="chapter-item "><a href="templates/generation.html"><strong aria-hidden="true">6.2.</strong> Card Generation</a></li><li class="chapter-item "><a href="templates/styling.html"><strong aria-hidden="true">6.3.</strong> Styling & HTML</a></li><li class="chapter-item "><a href="templates/errors.html"><strong aria-hidden="true">6.4.</strong> Checks and Errors</a></li></ol></li><li class="chapter-item "><a href="preferences.html"><strong aria-hidden="true">7.</strong> Preferences</a></li><li class="chapter-item "><a href="deck-options.html"><strong aria-hidden="true">8.</strong> Deck Options</a></li><li class="chapter-item "><a href="syncing.html"><strong aria-hidden="true">9.</strong> Syncing with AnkiWeb</a></li><li class="chapter-item "><a href="profiles.html"><strong aria-hidden="true">10.</strong> Profiles</a></li><li class="chapter-item "><a href="browsing.html"><strong aria-hidden="true">11.</strong> Browsing</a></li><li class="chapter-item "><a href="filtered-decks.html"><strong aria-hidden="true">12.</strong> Filtered Decks</a></li><li class="chapter-item "><a href="searching.html"><strong aria-hidden="true">13.</strong> Searching</a></li><li class="chapter-item "><a href="importing/intro.html"><strong aria-hidden="true">14.</strong> Importing</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="importing/text-files.html"><strong aria-hidden="true">14.1.</strong> Text Files</a></li><li class="chapter-item "><a href="importing/packaged-decks.html"><strong aria-hidden="true">14.2.</strong> Packaged Decks</a></li></ol></li><li class="chapter-item "><a href="exporting.html"><strong aria-hidden="true">15.</strong> Exporting</a></li><li class="chapter-item "><a href="backups.html"><strong aria-hidden="true">16.</strong> Backups</a></li><li class="chapter-item "><a href="files.html"><strong aria-hidden="true">17.</strong> Managing Files</a></li><li class="chapter-item "><a href="stats.html"><strong aria-hidden="true">18.</strong> Statistics</a></li><li class="chapter-item "><a href="media.html"><strong aria-hidden="true">19.</strong> Media</a></li><li class="chapter-item "><a href="math.html"><strong aria-hidden="true">20.</strong> Math & Symbols</a></li><li class="chapter-item "><a href="leeches.html"><strong aria-hidden="true">21.</strong> Leeches</a></li><li class="chapter-item "><a href="addons.html"><strong aria-hidden="true">22.</strong> Add-ons</a></li><li class="chapter-item expanded "><a href="sync-server.html" class="active"><strong aria-hidden="true">23.</strong> Sync Server</a></li><li class="chapter-item "><a href="misc.html"><strong aria-hidden="true">24.</strong> Miscellaneous</a></li><li class="chapter-item affix "><a href="contrib.html">Contributing</a></li><li class="chapter-item affix "><a href="faqs.html">FAQs</a></li><li class="chapter-item affix "><a href="resources.html">Resources</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Anki Manual</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/ankitects/anki-manual/" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="self-hosted-sync-server"><a class="header" href="#self-hosted-sync-server">Self-Hosted Sync Server</a></h1>
<p>Anki 2.1.57+ includes a built-in sync server. Advanced users who cannot or do
not wish to use AnkiWeb can use this sync server instead of AnkiWeb.</p>
<p>Things to be aware of:</p>
<ul>
<li>This is an advanced feature, targeted at users who are comfortable with
networking and the command line. If you use this, the expectation is you
can resolve any setup/network/firewall issues you run into yourself, and
use of this is entirely at your own risk.</li>
<li>Newer clients may depend on changes to the sync protocol, so syncing may
stop working if you update your Anki clients without also updating the server.</li>
<li>Third-party sync servers also exist. No testing is done against them, and
they tend to take time to catch up when the sync protocol changes, so they
are not recommended.</li>
<li>The messages inside Anki will use the term 'AnkiWeb' even if a custom server
has been configured, (e.g &quot;Cannot connect to AnkiWeb&quot; when your server is down).</li>
</ul>
<h2 id="installingrunning"><a class="header" href="#installingrunning">Installing/Running</a></h2>
<p>There are various ways you can install and run the server.</p>
<h3 id="from-a-packaged-build"><a class="header" href="#from-a-packaged-build">From a Packaged Build</a></h3>
<p>On Windows in a cmd.exe session:</p>
<pre><code>set SYNC_USER1=user:pass
&quot;\Program Files\anki\anki.exe&quot; --syncserver
</code></pre>
<p>Or MacOS, in Terminal.app:</p>
<pre><code>SYNC_USER1=user:pass /Applications/Anki.app/Contents/MacOS/anki --syncserver
</code></pre>
<p>Or Linux:</p>
<pre><code>SYNC_USER1=user:pass anki --syncserver
</code></pre>
<h3 id="with-pip"><a class="header" href="#with-pip">With Pip</a></h3>
<p>If you have Python 3.9+ installed, you can run from PyPI without downloading
all Anki's GUI dependencies.</p>
<pre><code>python3 -m venv ~/syncserver
~/syncserver/bin/pip install anki
SYNC_USER1=user:pass ~/syncserver/bin/python -m anki.syncserver
</code></pre>
<h3 id="with-cargo"><a class="header" href="#with-cargo">With Cargo</a></h3>
<p>If you have Rustup installed, from Anki 2.1.66+, you can build a standalone sync
server that doesn't require Python, using the following:</p>
<pre><code>cargo install --git https://github.com/ankitects/anki.git --tag 2.1.66 anki-sync-server
</code></pre>
<p>Replace 2.1.66 with whatever the latest Anki version is.</p>
<p>Protobuf (protoc) will need to be installed.</p>
<p>After running that, you can run it with</p>
<pre><code>SYNC_USER1=user:pass anki-sync-server
</code></pre>
<h3 id="from-a-source-checkout"><a class="header" href="#from-a-source-checkout">From a source checkout</a></h3>
<p>If you've cloned the Anki repo from GitHub, you can install from there:</p>
<pre><code>./ninja extract:protoc
cargo install --path rslib/sync
</code></pre>
<h2 id="multiple-users"><a class="header" href="#multiple-users">Multiple Users</a></h2>
<p>SYNC_USER1 declares the first user and password, and must be set.
You can optionally declare SYNC_USER2, SYNC_USER3 and so on, if you
wish to set up multiple accounts.</p>
<h2 id="storage-location"><a class="header" href="#storage-location">Storage Location</a></h2>
<p>The server needs to store a copy of your collection and media in a folder.
By default it is ~/.syncserver; you can change this by defining
a <code>SYNC_BASE</code> environmental variable. This must not be the same
location as your normal Anki data folder, as the server and client
must store separate copies.</p>
<h2 id="public-access"><a class="header" href="#public-access">Public Access</a></h2>
<p>The server listens on an unencrypted HTTP connection, so it's not a good
idea to expose it directly to the internet. You'll want to either restrict
usage to your local network, or place some form of encryption in front of
the server, such as a VPN (Tailscale is apparently easy), or a HTTPS
reverse proxy.</p>
<p>You can define <code>SYNC_HOST</code> and <code>SYNC_PORT</code> to change the host and port
that the server binds to.</p>
<h2 id="client-setup"><a class="header" href="#client-setup">Client Setup</a></h2>
<p>You'll need to determine your computer's network IP address, and then
point each of your Anki clients to the address, e.g something like
<code>http://192.168.1.200:8080/</code>. The URL can be configured in the preferences.</p>
<p>If you're using AnkiMobile and are unable to connect to a server on your local
network, please go into the iOS settings, locate Anki near the bottom, and
toggle &quot;Allow Anki to access local network&quot; off and then on again.</p>
<p>Older desktop clients required you to define SYNC_ENDPOINT and SYNC_ENDPOINT_MEDIA.
If using an older client, you'd put it as e.g. <code>http://192.168.1.200:8080/sync/</code>
and <code>http://192.168.1.200:8080/msync/</code> respectively. AnkiDroid clients before 2.16
require separate configuration for the two endpoints.</p>
<h2 id="reverse-proxies"><a class="header" href="#reverse-proxies">Reverse Proxies</a></h2>
<p>If using a reverse proxy to provide HTTPS access (e.g. nginx), and binding to a subpath
(e.g. <code>http://example.com/custom/</code> -&gt; <code>http://localhost:8080/</code>), you must make sure to
including a trailing slash when configuring Anki. If you put <code>http://example.com/custom</code>
instead, it will not work.</p>
<p>On iOS, TLS 1.3 is not supported, so your reverse proxy will need to have TLS 1.2
enabled, or you'll get an &quot;error code -9836&quot;.</p>
<h2 id="large-requests"><a class="header" href="#large-requests">Large Requests</a></h2>
<p>The standard AnkiWeb limit on uploads is applied by default. You can optionally
set MAX_SYNC_PAYLOAD_MEGS to something greater than 100 if you wish to increase
the limit. Bear in mind that if you're using a reverse proxy, you may need to
adjust the limit there as well.</p>
<h2 id="contributing-changes"><a class="header" href="#contributing-changes">Contributing Changes</a></h2>
<p>Because this server is bundled with Anki, simplicity is a design goal - it is
targeted at individual/family use, and PRs that add things like a REST API or
external databases are unlikely to be accepted at this time. If in doubt, please
reach out before starting work on a PR.</p>
<p>If you're looking for an existing API solution, the AnkiConnect add-on may
meet your needs.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="addons.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="misc.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="addons.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="misc.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
